<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>考场</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../../../../assets/lib/js/layui/css/modules/layer/default/layer.css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="../js/html5shiv.min.js"></script>
    <script src="../js/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-2.1.4.min.js"></script>
    <link rel="stylesheet" href="../css/video-js.css"/>
    <script src="../js/video.js"></script>
    <script src="../../../../assets/lib/js/layui/lay/modules/layer.js"></script>
    <!--<script src="videojs-contrib-hls.min.js" type="text/javascript"></script>-->
    <style>
        .examindex .content{color: white; font-family: 'Arial Normal', 'Arial';}
        /*左边顶部*/
        .examindex .content .leftinfo .lefttop{width:90%;height:40%;border-radius:15px;background-color:rgba(24,94,126,0.6);position:absolute;top:0;left:6%}
        .examindex .content .leftinfo .lefttop .timeinfo .title{height:30%;font-weight: 400;font-style: normal;font-size: 28px; color: #14BEE9; margin: 4% 0 0 4%;}
        .examindex .content .leftinfo .lefttop  .timeinfo .info{height:70%;text-align: center;font-weight: 400;font-style: normal; font-size: 72px;color: #FFE74A;}
        .examindex .content .leftinfo .lefttop  .timeinfo .begin{ position: absolute;left: 0;right: 0; top: 30%;text-align: center;font-weight: 400;font-style: normal; font-size: 50px;color: #FFE74A;}
        /*左边中间*/
        .examindex .content .leftinfo .leftcontent .info .examineeList{font-size: 20px;  font-weight: 100;  margin: 2%;}
        .examindex .content .leftinfo .leftcontent .info .examineeList .studentitem{float: left;    padding-right: 5%; }
        .examindex .content .leftinfo .leftcontent{width: 90%; height: 46%; border-radius: 15px; background-color: rgba(24,94,126,0.6);  position: absolute; top: 42%; left: 6%;}
        /*左边底部*/
        .examindex .content .leftinfo .leftbottom{width:90%;height:10%;border-radius:15px;background-color:rgba(24,94,126,0.6);position:absolute;bottom:0;left:6%}
        .subjectover{height:25%;width:100%;color:#afb1b3;font-size:20px;text-align:left;}
        .subjecton{height:25%;width:100%;color:white;font-size:20px;text-align:center;background-color:#1cacea;border-radius:20px;}
        .subjectleft{height:35px;width:100%;font-size:20px;text-align:center;border-radius: 15px;line-height:35px;}
        .subjectdetail{display:inline-block;}
        .Moved{color:white;background:#14bee9;position:absolute;margin:auto;left:45%;top:40%;z-index:1;height:200px;width:500px;border-radius:15px;}
        .XSbtn{display:inline-block;width:100px;height:35px;line-height:35px;background-color:blue;border-radius:15px;}
        .classstatus{display:inline-block;width:120px;height:35px;background-color:#f9b32c;line-height:35px;text-align:center;background-color:#f9b32c;border-radius:15px;}
        .vjs-playing{display:none !important;}
        .vjs-tech {pointer-events: none;}
        .myscroll {height:100%; margin: 0 auto;overflow: hidden;}
        .tst{padding:0 !important;}
    </style>
</head>
<body onload="clock()">
<!--主题内容开始-->
<div id="Main" class="Main examindex" >
    <!--头部开始 -->
    <div class="classinfo">
        <div class="schoolname" style="font-size: 40px;color: white; padding: 1%;"></div>
        <div class="currclock">
            <div class="clockTime">
            </div>
            <div class="clock" >
                <div class="clockDate"></div>
                <div class="clockWeek"></div>
            </div>
        </div>
    </div>
    <div style="height:88%;width:100%;" class="content">
        <div class="leftinfo" style="float:left;width:30%;height:100%;position:relative;">
            <div class="lefttop">
                <div style="text-align:center;height:20%;background-color:#143a48;border-top-left-radius:15px;border-top-right-radius:15px">
                    <div class="classinfo">
                        <span class="classname" style="line-height:70px;font-size:35px;position:relative;float:none;margin:0">302班</span>
                    </div>
                </div>
                <div style="width:100%;height:80%;">
                    <table style="height:100%;width:100%;font-size:20px">
                        <tr>
                            <td rowspan="5" style="width:40%;text-align:center">
                                <img id="photo" src="../resource/u1275.svg" style="width:120px;">
                            </td>
                            <td style="width:60%;" id="subject">科目：-</td>
                        </tr>
                        <tr>
                            <td id="teacher">主讲：-</td>
                        </tr>
                        <tr>
                            <td id="time">时间：-</td>
                        </tr>
                        <tr>
                            <td><span class="classstatus" id="status">上课中</span></td>
                        </tr>
                        <tr>
                            <td style="color:#12c1e9;display:none"><span>迟到：<span style="color:#eba93b">0</span>人 缺勤：<span style="color:#eba93b">0</span>人</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="leftcontent">
                <div style="float:left;height:100%;width:100%; font-weight: 700;font-style: normal; font-size: 23px;color: #FDFCFD;">
                    <div class="title" style="height:5%; margin: 4% 0 0 4%;  position: relative;">
                        <img src='../resource/u434.png' style="position: absolute; top: 0;"/>
                        <span style="position: absolute;top:0;left:50px;">今日课表</span>
                    </div>
                    <div class="info" style="height:82.5%;color:white">
                        <div id="classList" class="examineeList myscroll"></div>
                    </div>
                </div>
            </div>
            <div class="leftbottom">
                <div style="height: 100%; width: 100%;font-weight: 400;font-style: normal;font-size: 20px;color: #FDFCFD">
                    <div onclick="window.CallCSharpMethod('ShowSwitchMode','')" style="float:left;margin-top:6%;margin-left:6%;position:relative;width:25%;cursor:pointer">
                        <img src='../resource/modeswitching.png' style=" width:30px;"/>
                        <span style="position: absolute;left:30% ">模式切换</span>
                    </div>
                    <div style="display:none;float:left;margin-top:6%;margin-left:6%;position:relative;width:25%;cursor:pointer">
                        <img src='../resource/u600.svg' style="width:35px;"/>
                        <span style="position: absolute;left:30% ">查看考勤</span>
                    </div>
                    <div onclick="MovedShow();" style="float:left;margin-top:6%;margin-left:6%;position:relative;width:25%;cursor:pointer">
                        <img src='../resource/u1328.svg' style="width:35px;"/>
                        <span style="position: absolute;left:30%">巡视打卡</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="rightinfo" style="float:left;width:70%;height:100%;position:relative;">
            <div class="rightdiv" style="  width:97.5%;height:100%;border-radius:15px;background-color:rgba(24,94,126,0.6);position:absolute;font-weight: 400;font-style: normal; font-size: 120px; color: #FDFCFD; text-align: center;">
                <div class="player-wrapper" style="margin:0 auto;width:100%;position:relative;height:100%">
                    <div class="video-inner" style="position:absolute;top:0;bottom:0;left:0;right:0;">
                        <video muted="true" id="videojs" class="video-js vjs-default-skin vjs-big-play-centered" style="width: 100%; height: 100%;display:block !important" controls preload="none" poster="" x5-video-player-fullscreen="true" x5-video-player-type="h5">
                            <source src="rtmp://119.3.31.99/SolaLive/6" type="rtmp/mp4"></source>
                            <p class="vjs-no-js">
                                To view this video please enable JavaScript, and consider upgrading to a web browser that
                                <a href="http://videojs.com/html5-video-support/" target="_blank">
                                    supports HTML5 video
                                </a>
                            </p>
                        </video>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--主题内容结束-->
<div  class="Moved" id="teacherCard" style="display:none;">
    <div style="height: 10%;position: absolute; right: 1%;top: 2%;"><img src="../resource/close.png"  style="cursor: pointer" onclick="MovedShow()"/></div>
    <div style="padding-left:20px;margin-top:50px;">上次打卡时间：2019-07-09 14:07:00</div>
    <div style="height:55px;padding-left:20px;line-height:55px">巡视老师：陈丹</div>
    <div style="text-align:center"><span onclick="layer.alert('打卡成功!');MovedShow();" class="XSbtn pointer">打卡</span><span onclick="MovedShow();" style="margin-left:10px" class="XSbtn pointer">取消</span></div>
</div>
<script src="../js/jquery-2.1.4.min.js"></script>
<script src="../js/jquery-1.11.3.min.js"></script>
<script src="../js/common.js"></script>
<script>
    setTimeout(function(){
        document.getElementsByTagName('body')[0].style.height = window.innerHeight+'px';
        $("#Main").height(window.innerHeight);
    },20);
</script>
<script>
function autoScroll(obj){
    $(obj).find('ul').animate({
        marginTop: '-35px'
    },2000,function(){
        $(this).css({marginTop : "0px"});
        var li  =$("ul").children().first().clone()
        /*$("ul li:last").after(li);*/
        $("ul").append(li);
        $("ul li:first").remove();
    })
}
$(function(){
    setInterval('autoScroll("#classList")',60);

})
    videojs.options.flash.swf = 'video-js-fixed.swf';
    videojs.options.techOrder = ['html5','flash'];
    var player = null;
    var videoUrl="rtmp://127.0.0.1:10935/hls/stream_1";
    player = videojs("videojs",{
        notSupportedMessage : '您的浏览器没有安装或开启Flash,戳我开启！',
        techOrder : ["flash"],
        autoplay : true,
        sources:[{src:getQueryVariable("liveUrl"),type:'rtmp/mp4'}]
    });
    player.on("error",function(e){
        var $e = $(".vjs-error .vjs-error-display .vjs-modal-dialog-content");
        var $a = $("<a href='http://www.adobe.com/go/getflashplayer' target='_blank'></a>").text($e.text());
        $e.empty().append($a);
    });
/*    player = videojs("videojs",{
        notSupportedMessage : '您的浏览器没有安装或开启Flash,戳我开启！',
        techOrder : ["flash"],
        autoplay : true,
        sources:[{src:getQueryVariable("liveUrl"),type:'rtmp/mp4'}]
    });*/
    //player.on("error",function(e){
    //    var $e = $(".vjs-error .vjs-error-display .vjs-modal-dialog-content");
    //   var $a = $("<a href='http://www.adobe.com/go/getflashplayer' target='_blank'></a>").text($e.text());
    //    $e.empty().append($a);
    //});
    //player.on("error",function(e){
    //    var $e = $(".vjs-error .vjs-error-display .vjs-modal-dialog-content");
    //    var $a = $("<a href='http://www.adobe.com/go/getflashplayer' target='_blank'></a>").text($e.text());
    //    $e.empty().append($a);
    //});


/*    var myVideo = videojs('videojs', {
	    bigPlayButton: true,
	    textTrackDisplay: false,
	    posterImage: false,
	    errorDisplay: false,
        muted: true,
        controls:true //控制按钮
     });
 
    function GetLiveUrl (vdoSrc) {
        if (/\.m3u8$/.test(vdoSrc)) {
            //判断视频源是否是m3u8的格式
            myVideo.src({
                src: vdoSrc,
                type: 'application/x-mpegURL' //在重新添加视频源的时候需要给新的type的值
            })
        } else {
            myVideo.src({
                src: vdoSrc,
                type: 'rtmp/mp4' //在重新添加视频源的时候需要给新的type的值
            })
        }
        myVideo.load();
        myVideo.play();
    }

    GetLiveUrl(getQueryVariable("liveUrl"));*/
    
    function MovedShow() {
        if($('#teacherCard').is(':hidden')){
            $('#teacherCard').show();
            //如果隐藏时。。。
        }else{
            $('#teacherCard').hide();
            //如果显示时。。。
        }
    }

    var mydate=new Date();
    var myddy=mydate.getDay();//获取存储当前日期
    var weekday=["7","1","2","3","4","5","6"];

    //获取课程
    var curriculumData = [];
    function initClassCurriclumData()
    {
        InitClassInfo();
        curriculumData = [];
        var schoolId = classInfo.schoolId;
        var classId = classInfo.classId;
        if($.trim(classId) == "") return;
        jQuery.ajax({
            type: "POST",
            data: {"schoolId":schoolId,"classId":classId},
            dataType: "json",
            url: "/service/eclassbrand/getSchoolClassCurriculumLists",
            success: function (result) {
                curriculumData = result;
                initDataList();
            },
            error:function () {

            }
        });
    }

    //加载课程
    function initDataList() {
        var data = "";
        var classId = classInfo.classId;
        if ($.trim(classId) == "") return;
        jQuery.ajax({
            type: "POST",
            data: {"schoolId": classInfo.schoolId, "stageId": classInfo.stageId},
            dataType: "json",
            url: "/service/eclassbrand/getSchoolScheduleList",
            success: function (result) {
                var isall=false;
                data=data+"<ul class='tst'>";
                for (var i = 0; i < result.length; i++) {
                    var item = result[i];
                    var currenti = false;
                    for (var j = 0; j < item.weekTimeList.length; j++) {
                        var item0 = item.weekTimeList[j];
                        if (item0.week == weekday[myddy]) {
                            if (CompareDate(item0.starttime, item0.endtime)) {
                                currenti = true;
                                isall=true;
                            }
                        }
                    }
                    data = data + getCurrName(weekday[myddy], item.weekTimeList, item.session, currenti);
                }
                data=data+"</ul>";
                $("#classList").html(data);
                if(isall)
                    $("#status").html("上课中");
                else {
                    $("#status").html("当前无课");
                }
            },
            error: function () {

            }
        });
    }

    function getCurrName(week, weekTimeList, session,iscurr) {
        var result = "";
        for (var i = 0; i < curriculumData.length; i++) {
            var item = curriculumData[i];
            if (item.week == week && item.session == session) {

                if (iscurr) {
                    $("#subject").html("科目:" + item.subjectName);
                    $("#teacher").html("主讲:" + item.teacherName);
                    initteacher(item.teacherid);
                    result = "<li><div style='background-color:#86631f;' class=\"subjectleft\"><span class=' HidTxt' style='display:inline-block;width:30%;vertical-align:middle;'>" + item.subjectName + "</span><span style='width:35%;vertical-align:middle;' class=\"subjectdetail\">" + item.teacherName + "</span>";
                } else
                    result = "<li><div class=\"subjectleft\"><span class=' HidTxt' style='display:inline-block;width:30%;vertical-align:middle;'>" + item.subjectName + "</span><span style='width:35%;vertical-align:middle;' class=\"subjectdetail\">" + item.teacherName + "</span>";
            }
        }


        for (var i = 0; i < weekTimeList.length; i++) {
            var item1 = weekTimeList[i];
            if (item1.week == week) {
                if (iscurr) {
                    $("#time").html("时间:" + item1.starttime + "~" + item1.endtime);
                    result = result + "<span class=\"subjectdetail  HidTxt\" style='margin-left:0;width: 35%;vertical-align:middle;'>" + item1.starttime + "~" + item1.endtime + "</span></div></li>";
                } else
                    result = result + "<span class=\"subjectdetail  HidTxt\" style='margin-left:0;width: 35%;vertical-align:middle;'>" + item1.starttime + "~" + item1.endtime + "</span></div></li>";
            }
        }

        return result;
    }

    //判断课程时间
    function CompareDate(t1,t2)
    {
        var date = new Date();
        var dangqian=date.toLocaleTimeString('chinese',{hour12:false})

        var dq=dangqian.split(":");
        var a = t1.split(":");
        var b = t2.split(":");

        var dqdq=parseInt(dq[0])*60+parseInt(dq[1]);
        var aa=parseInt(a[0])*60+parseInt(a[1]);
        var bb=parseInt(b[0])*60+parseInt(b[1]);

        return (aa<=dqdq)&&(dqdq<=bb)

    }

    //获取教师信息
    function initteacher(id) {
        jQuery.ajax({
            type: "POST",
            data: {"teacherid": id},
            dataType: "text",
            url: "/service/eclassbrand/getteacherinfo",
            success: function (result) {
                var obj = eval("(" + result + ")");
                $("#photo").attr("src", "/" + obj.photo);
            },
            error: function () {
            }
        });
    }

    function getQueryVariable(variable)
    {
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
    }
    
    function getliveUrl(){
       $("#videojs").html('<source id="liveUrl" src="'+ getQueryVariable("liveUrl") +'" type="rtmp/mp4"></source>');
    }

    $(function () {
        initClassCurriclumData();
    });
</script>
</body>
</html>